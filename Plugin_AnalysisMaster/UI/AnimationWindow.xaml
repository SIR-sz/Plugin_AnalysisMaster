<Window x:Class="Plugin_AnalysisMaster.UI.AnimationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Plugin_AnalysisMaster.UI" 
        Title="分析动画管理器" Height="580" Width="380" 
        Topmost="True" WindowStartupLocation="CenterOwner"
        WindowStyle="None" AllowsTransparency="True" Background="Transparent">

    <Window.Resources>
        <local:IndexConverter x:Key="IndexConverter"/>
        <local:ColorToBrushConverter x:Key="ColorToBrushConverter"/>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="#BBB"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <Style TargetType="GridViewColumnHeader">
            <Setter Property="Background" Value="#333"/>
            <Setter Property="Foreground" Value="#BBB"/>
            <Setter Property="BorderBrush" Value="#222"/>
            <Setter Property="Padding" Value="5,4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GridViewColumnHeader">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="0,0,1,1">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ListViewItem">
            <Setter Property="Foreground" Value="#EEE"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListViewItem">
                        <Border Name="Bd" Background="{TemplateBinding Background}" SnapsToDevicePixels="true">
                            <GridViewRowPresenter VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="true">
                                <Setter TargetName="Bd" Property="Background" Value="#3E3E42"/>
                                <Setter Property="Foreground" Value="#2196F3"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter TargetName="Bd" Property="Background" Value="#333"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#3D3D3D"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#505050"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DarkInputStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#2D2D2D"/>
            <Setter Property="Foreground" Value="#2196F3"/>
            <Setter Property="BorderBrush" Value="#444"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="2"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style TargetType="ListView">
            <Setter Property="Background" Value="#252525"/>
            <Setter Property="BorderBrush" Value="#333"/>
            <Setter Property="Foreground" Value="#EEE"/>
        </Style>
    </Window.Resources>

    <Border Background="#1E1E1E" CornerRadius="12" BorderBrush="#333" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="15" Color="#AA000000" Direction="270" ShadowDepth="3"/>
        </Border.Effect>

        <Grid Margin="15">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,0,10" Background="Transparent" MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <TextBlock Text="🎬 动画序列管理" Foreground="#E0E0E0" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
                <Button Content="✕" HorizontalAlignment="Right" Width="24" Height="24" 
                        Background="Transparent" Foreground="#666" BorderBrush="Transparent" Click="Close_Click">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>

            <StackPanel Orientation="Horizontal" Grid.Row="1" Margin="0,0,0,10">
                <Button Content="➕ 添加路径" Click="AddPath_Click" Width="85" Margin="0,0,5,0" Style="{StaticResource DarkButtonStyle}" Background="#2196F3"/>
                <Button Content="➖ 移除" Click="RemovePath_Click" Width="65" Margin="0,0,5,0" Style="{StaticResource DarkButtonStyle}"/>
                <Button Content="🧹 清空" Click="ClearPaths_Click" Width="65" Style="{StaticResource DarkButtonStyle}"/>
            </StackPanel>

            <ListView x:Name="PathListView" Grid.Row="2" SelectionChanged="PathListView_SelectionChanged" BorderThickness="1">
                <ListView.View>
                    <GridView>
                        <GridViewColumn Header="顺序" Width="45">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListViewItem}}, Converter={StaticResource IndexConverter}}" HorizontalAlignment="Center"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="组" Width="45">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBox Text="{Binding GroupNumber, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource DarkInputStyle}" Width="30" TextAlignment="Center"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="颜色" Width="45">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Rectangle Width="14" Height="14" RadiusX="2" RadiusY="2" Fill="{Binding PathColor, Converter={StaticResource ColorToBrushConverter}}" Stroke="#444"/>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn Header="路径描述" DisplayMemberBinding="{Binding Name}" Width="150"/>
                    </GridView>
                </ListView.View>
            </ListView>

            <StackPanel Grid.Row="3" Margin="0,15,0,15">
                <DockPanel Margin="0,5">
                    <TextBlock Text="演示加粗: " VerticalAlignment="Center"/>
                    <TextBox DockPanel.Dock="Right" Text="{Binding ElementName=ThicknessSlider, Path=Value, StringFormat={}{0:F0}}" 
                             Style="{StaticResource DarkInputStyle}" Width="45" Margin="10,0,0,0" TextAlignment="Right"/>
                    <Slider x:Name="ThicknessSlider" Minimum="0" Maximum="100" Value="2" TickFrequency="1" IsSnapToTickEnabled="True" VerticalAlignment="Center"/>
                </DockPanel>

                <StackPanel Orientation="Horizontal" Margin="0,5,0,10">
                    <CheckBox x:Name="LoopCheck" Content="循环播放" Foreground="#BBB" VerticalAlignment="Center"/>
                    <CheckBox x:Name="PersistenceCheck" Content="播放后保留迹线" IsChecked="True" Foreground="#BBB" Margin="25,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <DockPanel Margin="0,5">
                    <TextBlock Text="播放速度: " VerticalAlignment="Center"/>
                    <TextBox DockPanel.Dock="Right" Text="{Binding ElementName=SpeedSlider, Path=Value, StringFormat={}{0:F0}x}" 
                             Style="{StaticResource DarkInputStyle}" Width="45" Margin="10,0,0,0" TextAlignment="Right"/>
                    <Slider x:Name="SpeedSlider" Minimum="1" Maximum="20" Value="1" TickFrequency="1" IsSnapToTickEnabled="True" VerticalAlignment="Center"/>
                </DockPanel>
            </StackPanel>

            <UniformGrid Grid.Row="4" Columns="2" Margin="0,5">
                <Button x:Name="BtnPlay" Content="▶ 开始播放" Height="38" Margin="0,0,5,0" Click="BtnPlay_Click" 
                        Background="#4CAF50" FontWeight="Bold" Style="{StaticResource DarkButtonStyle}"/>
                <Button x:Name="BtnStop" Content="■ 停止" Height="38" Click="BtnStop_Click" 
                        Background="#F44336" FontWeight="Bold" Style="{StaticResource DarkButtonStyle}"/>
            </UniformGrid>
        </Grid>
    </Border>
</Window>